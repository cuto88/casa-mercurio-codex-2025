modbus:
  - name: mirai_modbus
    type: tcp
    host: 192.168.178.33
    port: 502
    delay: 1
    timeout: 5
    sensors:
      # Stato principale ON/OFF (1=acceso, 0=spento)
      - scan_interval: 15
        slave: 1
        input_type: holding
        address: 3503
        data_type: uint16
        name: "MIRAI unit on/off (raw)"
        unique_id: mirai_unit_onoff_raw_main

      # Stato backup ON/OFF su registro alternativo
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 1002
        data_type: uint16
        name: "MIRAI unit on/off backup (raw)"
        unique_id: mirai_unit_onoff_raw_backup

      # Status word diagnostica
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 1003
        data_type: uint16
        name: "MIRAI status word (raw)"
        unique_id: mirai_status_word_raw

      # Temperatura esterna (scala 1:1)
      - scan_interval: 15
        slave: 1
        input_type: holding
        address: 4035
        data_type: int16
        name: "MIRAI outdoor temperature"
        unique_id: mirai_outdoor_temperature
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement
        precision: 0

      # Temperatura mandata/ritorno alta (scala 0.1)
      - scan_interval: 15
        slave: 1
        input_type: holding
        address: 3526
        data_type: int16
        name: "MIRAI circuit 1 temperature"
        unique_id: mirai_circuit_1_temperature
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement
        scale: 0.1
        precision: 1

      # Temperatura aggiuntiva (scala 0.1)
      - scan_interval: 15
        slave: 1
        input_type: holding
        address: 3508
        data_type: int16
        name: "MIRAI circuit 2 temperature"
        unique_id: mirai_circuit_2_temperature
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement
        scale: 0.1
        precision: 1

      # Temperatura compatta (scala 0.1)
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 1015
        data_type: int16
        name: "MIRAI internal temperature"
        unique_id: mirai_internal_temperature
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement
        scale: 0.1
        precision: 1

      # Setpoint principale (probabile scala 0.1)
      - scan_interval: 15
        slave: 1
        input_type: holding
        address: 3522
        data_type: int16
        name: "MIRAI main setpoint"
        unique_id: mirai_main_setpoint
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement
        scale: 0.1
        precision: 1

      # Setpoint secondario (scala da verificare)
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 1013
        data_type: int16
        name: "MIRAI secondary setpoint"
        unique_id: mirai_secondary_setpoint
        unit_of_measurement: "°C"
        precision: 1
        # scala da verificare

      # Energia totale (uint32 con swap little-endian)
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 4046
        data_type: uint16
        name: "MIRAI energy high word (raw)"
        unique_id: mirai_energy_high_word_raw
        unit_of_measurement: "kWh"
        device_class: energy
        state_class: total_increasing
        # verifica scala reale kWh

      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 4047
        data_type: uint16
        name: "MIRAI energy low word (raw)"
        unique_id: mirai_energy_low_word_raw
        unit_of_measurement: "kWh"
        device_class: energy
        state_class: total_increasing
        # verifica scala reale kWh

      # Stato diagnostico
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 1208
        data_type: uint16
        name: "MIRAI status code (raw)"
        unique_id: mirai_status_code_raw

      # Codice diagnostico
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 1209
        data_type: uint16
        name: "MIRAI fault code (raw)"
        unique_id: mirai_fault_code_raw

      # Potenza/tempo diagnostica
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 3022
        data_type: uint16
        name: "MIRAI parameter 3022 (raw)"
        unique_id: mirai_parameter_3022_raw

      # Bitmask diagnostica 4000
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 4000
        data_type: uint16
        name: "MIRAI bitmask 4000 (raw)"
        unique_id: mirai_bitmask_4000_raw

      # Bitmask diagnostica 4001
      - scan_interval: 30
        slave: 1
        input_type: holding
        address: 4001
        data_type: uint16
        name: "MIRAI bitmask 4001 (raw)"
        unique_id: mirai_bitmask_4001_raw
