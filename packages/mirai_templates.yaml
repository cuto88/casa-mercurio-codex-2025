template:
  - binary_sensor:
      - name: "MIRAI status word bit 00"
        unique_id: mirai_status_word_bit_00
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**0)) != 0 }}
      - name: "MIRAI status word bit 01"
        unique_id: mirai_status_word_bit_01
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**1)) != 0 }}
      - name: "MIRAI status word bit 02"
        unique_id: mirai_status_word_bit_02
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**2)) != 0 }}
      - name: "MIRAI status word bit 03"
        unique_id: mirai_status_word_bit_03
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**3)) != 0 }}
      - name: "MIRAI status word bit 04"
        unique_id: mirai_status_word_bit_04
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**4)) != 0 }}
      - name: "MIRAI status word bit 05"
        unique_id: mirai_status_word_bit_05
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**5)) != 0 }}
      - name: "MIRAI status word bit 06"
        unique_id: mirai_status_word_bit_06
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**6)) != 0 }}
      - name: "MIRAI status word bit 07"
        unique_id: mirai_status_word_bit_07
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**7)) != 0 }}
      - name: "MIRAI status word bit 08"
        unique_id: mirai_status_word_bit_08
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**8)) != 0 }}
      - name: "MIRAI status word bit 09"
        unique_id: mirai_status_word_bit_09
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**9)) != 0 }}
      - name: "MIRAI status word bit 10"
        unique_id: mirai_status_word_bit_10
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**10)) != 0 }}
      - name: "MIRAI status word bit 11"
        unique_id: mirai_status_word_bit_11
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**11)) != 0 }}
      - name: "MIRAI status word bit 12"
        unique_id: mirai_status_word_bit_12
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**12)) != 0 }}
      - name: "MIRAI status word bit 13"
        unique_id: mirai_status_word_bit_13
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**13)) != 0 }}
      - name: "MIRAI status word bit 14"
        unique_id: mirai_status_word_bit_14
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**14)) != 0 }}
      - name: "MIRAI status word bit 15"
        unique_id: mirai_status_word_bit_15
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {{ (v | bitwise_and(2**15)) != 0 }}
      - name: "MIRAI L243 internal circulator on"
        unique_id: mirai_l243_internal_circulator_on
        availability: >
          {{ states('sensor.mirai_l243_internal_circulator') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {{ states('sensor.mirai_l243_internal_circulator') | int(0) != 0 }}
      - name: "MIRAI L244 relaunch pump output on"
        unique_id: mirai_l244_relaunch_pump_on
        availability: >
          {{ states('sensor.mirai_l244_relaunch_pump') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {{ states('sensor.mirai_l244_relaunch_pump') | int(0) != 0 }}
      - name: "MIRAI L241 antifreeze lvl1 on"
        unique_id: mirai_l241_antifreeze_lvl1_on
        availability: >
          {{ states('sensor.mirai_l241_antifreeze_lvl1') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {{ states('sensor.mirai_l241_antifreeze_lvl1') | int(0) != 0 }}
      - name: "MIRAI L242 antifreeze lvl2 on"
        unique_id: mirai_l242_antifreeze_lvl2_on
        availability: >
          {{ states('sensor.mirai_l242_antifreeze_lvl2') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {{ states('sensor.mirai_l242_antifreeze_lvl2') | int(0) != 0 }}

  - sensor:
      - name: "MIRAI status bits ON"
        unique_id: mirai_status_bits_on
        icon: mdi:format-list-bulleted
        availability: >
          {{ states('sensor.mirai_status_word_raw') not in ['unknown','unavailable','none','None',''] }}
        state: >
          {% set v = states('sensor.mirai_status_word_raw') | int(0) %}
          {% set bits = [] %}
          {% for i in range(0,16) %}
            {% if (v | bitwise_and(2**i)) != 0 %}
              {% set bits = bits + [i] %}
            {% endif %}
          {% endfor %}
          {{ bits | join(',') }}
      - name: "MIRAI L162 outlet water temp Â°C"
        unique_id: mirai_l162_outlet_water_temp_c
        availability: >
          {{ states('sensor.mirai_l162_outlet_water_temp') not in ['unknown','unavailable','none','None',''] }}
        device_class: temperature
        unit_of_measurement: "Â°C"
        state_class: measurement
        state: >
          {{ (states('sensor.mirai_l162_outlet_water_temp') | float(0) / 10) | round(1) }}
