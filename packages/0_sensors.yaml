---
###############################################################################
# 0_sensors.yaml — Sensori climatici canonici e KPI base (ΔT/ΔAH)
# - ΔT in-out
# - ΔAH in-out
###############################################################################

template:
  - sensor:
      - name: "Delta T in-out"
        unique_id: delta_t_in_out
        unit_of_measurement: "°C"
        device_class: temperature
        state_class: measurement
        state: >-
          {% set tin = states('sensor.t_in_media')|float(default=nan) %}
          {% set tout = states('sensor.t_out')|float(default=nan) %}
          {% if tin is number and tout is number %}
            {{ (tin - tout) | round(2) }}
          {% else %}
            unknown
          {% endif %}

      - name: "Delta AH in-out"
        unique_id: delta_ah_in_out
        unit_of_measurement: "g/m³"
        state_class: measurement
        state: >-
          {% set ah_in = states('sensor.ah_in')|float(default=nan) %}
          {% set ah_out = states('sensor.ah_out')|float(default=nan) %}
          {% if ah_in is number and ah_out is number %}
            {{ (ah_in - ah_out) | round(2) }}
          {% else %}
            unknown
          {% endif %}
