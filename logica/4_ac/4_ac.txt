# 4_ac — Logica climatizzazione Casa Mercurio

## Obiettivi
- Comfort estivo con priorità deumidifica (DRY) prima del raffrescamento (COOL), nel rispetto dei blocchi notturni 23–07.
- Limitare cicli on/off e coordinare l’AC con la VMC per evitare controbilanciamenti e condensa.

## Sensori, clima entity e attuatori
- Zone: **giorno** (sensor.t_in_giorno, sensor.ur_in_giorno) e **notte** (sensor.t_in_notte1, sensor.ur_in_notte1); meteo: sensor.t_out, sensor.ur_out.
- Attuatori: `switch.ac_giorno` e `switch.ac_notte` (controllo IR dei due split). Etichette modalità in `sensor.ac_mode_label`.
- Helper soglie/lock: input_number.ac_ur_high/target, ac_t_cool_on, ac_t_target, ac_hyst_off, ac_min_on, ac_min_off, ac_max_run.

## Collegamenti ai core rules
- La logica DRY/COOL, lock anti-ciclo e blocchi orari seguono **core/regole_core_logiche.md → sezione "AC — Modalità, lock e interazioni"**.
- `binary_sensor.ac_need_dry` / `ac_need_cool` implementano i trigger core (UR alta, ΔAH favorevole, T_in sopra setpoint+isteresi).
- `binary_sensor.ac_fascia_ok` applica il blocco 23–07; `binary_sensor.ac_blocco_vmc` rappresenta l’hook `hook_vmc_request_ac_block` (free-cooling/ΔAH sfavorevole).
- DRY invia `hook_ac_request_vmc_low` tramite automazioni che modulano la VMC su vel_0/vel_1 quando `sensor.ac_mode_label` è DRY.
- I timer anti on/off usano gli input_number di lock core e filtrano `binary_sensor.ac_should_run` prima di agire sugli switch.

## Eccezioni locali / tuning specifico
- Zona notte più conservativa: stesso blocco COOL 23–07 e DRY ammesso solo con UR molto alta o override manuale.
- Setpoint iniziali Casa Mercurio: DRY sopra 75% UR, COOL da 27 °C (26 °C se UR ≥65%), rientro a 26.2 °C con isteresi 0.2 °C.
- Manual override: input_boolean.ac_manual + input_select.ac_manual_mode possono scavalcare blocco notte/emergenza con timeout timer.ac_manual_timeout.

## Note di implementazione YAML
- Logiche e helper in `packages/3_ac.yaml`: binary_sensor `ac_need_*`, `ac_fascia_ok`, `ac_should_run`, `ac_blocco_vmc`, contatori runtime.
- Automazioni locali mappano le decisioni sui due switch split rispettando i lock core e gli hook VMC.
- Nessun duplicato delle regole core: le soglie numeriche sono editabili via input_number e usate dalle automazioni di accensione/spegnimento.
